;;; read/write binary (sound) files
;;;
;;; names are read|write b|l int|float n, 
;;;   so read-bint32 reads the next 4 bytes from the current input port,
;;;   interpreting them as a big-endian 32-bit integer

(provide 'snd-binary-io.scm)


;;; -------- strings (0-terminated)

(define (io-read-string)
  (do ((chars ())
       (c (read-byte) (read-byte)))
      ((or (eof-object? c)
	   (= c 0))
       (reverse (apply string chars)))
    (set! chars (cons (integer->char c) chars))))

(define (io-write-string str)
  (format () "窿篝颟花骘颦遽汨黩轸瀛汨狎篝颟黩轸瀛怡翦癌换篝蜷铉躅翦蝽轭狒邃ㄤ彐轭濯蝈徜汨狎戾穿蝈徜篝蜷铉戾瞟｜ㄤè篝磲脲篝蜷铉戾瞟ㄩǐ暴┅è戾瞟篝颟箦簟篝椹蝈徜汨狎┅┅ㄤ彐轭黩轸瀛汨狎篝颟ㄦ矧磲ī窿篝颟ㄦ矧遽汨黩轸瀛汨狎篝颟换倍忾轭趔ㄤ彐轭蝈徜忾铘倍戾è轭ǐㄡ箬蝈徜怡翦俯蝈徜怡翦┅┅翳轶溴疱钿镱狎弼犰踽糸镱戾骠掘殓梏ㄩ轭巢范珐ō轭兜党订轭舂┅ㄤ彐轭蝈徜扉铘倍戾è轭ǐ蝈徜怡翦ㄡ箬蝈徜怡翦俯┅ㄩ轭巢范珐ō轭兜党订轭舂┅ㄤ彐轭黩轸瀛忾铘倍轭舂黩轸瀛怡翦祜玑钿ㄡ箬轭俯ｘ骀┅黩轸瀛怡翦祜玑钿轭ｘ骀┅ㄤ彐轭黩轸瀛扉铘倍轭舂黩轸瀛怡翦祜玑钿轭ｘ骀┅黩轸瀛怡翦祜玑钿ㄡ箬轭俯ｘ骀┅换巢忾轭趔ㄤ彐轭蝈徜忾铘巢戾è轭ǐㄡ箬蝈徜怡翦泊ㄡ箬蝈徜怡翦倍ㄡ箬蝈徜怡翦俯蝈徜怡翦┅┅ㄩ轭脖捶锤扯捶ō轭床勾苟凡苟轭舂┅ㄤ彐轭蝈徜扉铘巢戾è轭ǐ蝈徜怡翦ㄡ箬蝈徜怡翦俯ㄡ箬蝈徜怡翦倍ㄡ箬蝈徜怡翦泊┅┅ㄩ轭脖捶锤扯捶ō轭床勾苟凡苟轭舂┅ㄤ彐轭黩轸瀛忾铘巢轭舂ㄦ矧遽汨黩轸瀛怡翦鲥泗矧祜玑钿ㄡ箬轭泊驳旦祜玑钿ㄡ箬轭倍驳旦祜玑钿ㄡ箬轭俯驳旦祜玑钿轭驳旦┅ㄤ彐轭黩轸瀛扉铘巢轭舂ㄦ矧遽汨黩轸瀛怡翦鲥泗矧祜玑钿轭驳旦祜玑钿ㄡ箬轭俯驳旦祜玑钿ㄡ箬轭倍驳旦祜玑钿ㄡ箬轭泊驳旦┅换洞忾轭趔ㄤ彐轭蝈徜忾铘洞ㄤè轭癌ㄩ刀ō俯┅è癌轭舂箦簟轭祜玳矧轭ㄡ箬蝈徜怡翦椹┅┅ㄤ彐轭蝈徜扉铘洞ㄤè轭癌ㄩǐ俯┅è洞轭舂箦簟轭祜玳矧轭ㄡ箬蝈徜怡翦椹┅┅ㄤ彐轭黩轸瀛忾铘洞轭舂ㄤè刀ō俯┅è癌黩轸瀛怡翦祜玑钿ㄡ箬轭ō椹ｘ骀┅┅ㄤ彐轭黩轸瀛扉铘洞轭舂ㄤèǐ俯┅è洞┅黩轸瀛怡翦祜玑钿ㄡ箬轭ō椹ｘ骀┅┅换巢忾骒镝趔ㄉ排返船箝珙渤ǐ暴忾趔箝珙殒殂犷忾趔屮痫铄铘ㄤ彐轭ㄩ铘唪镞骒镝舫轭舂ㄩ弪锟轭舂爱íㄩ弪锟ㄡ箬轭潮┅碑碑癌ㄥ痿ō祜玑钿ㄡ箬轭渤ｘ骀辈珐祜玳矧ｘ赴鞍鞍祜玑钿轭ｘ锋骀骀┅ㄥ痿渤┅┅ㄤ彐轭蝈徜怄祜狒巢ㄩ铘唪镞骒镝舫蝈徜忾铘巢┅ㄤ彐轭蝈徜戽祜狒巢ㄩ铘唪镞骒镝舫蝈徜扉铘巢┅ㄤ彐轭ㄦ祜狒洞唪镞轭舫骒舂戾è溽翎ㄩ铘彗弪溴泔溴骒镝骒舂┅戾è箝珙殒ㄣ狎溽翎┅ㄥ痫ㄣ徜溽翎┅箝珙ㄣ徜潋溽翎┅ㄩ屮痫箝珙殒癌换麇蝈狍篚黹铉骒镝趔狎ǘ喘忾舂滹踱戾轭蠓箫翳轶轶泔弪汩铉麸巢忾骒镝轭箦铙换翳轶汜躞弩箫礤蝻躅洵镦弪蝻祜玳矧ㄩ铄玑糸鲥箝珙ｘ赴鞍鞍鞍癌ㄡ箬ǐ屮痫狈供渤狈ǐ挡辈珐祜玑钿ㄡ箬箝珙殒补ｘ锋骀骀┅┅┅ㄤ彐轭黩轸瀛怄祜狒巢骒舂黩轸瀛忾铘巢ㄦ祜狒洞唪镞轭舫骒舂┅ㄤ彐轭黩轸瀛戽祜狒巢骒舂黩轸瀛扉铘巢ㄦ祜狒洞唪镞轭舫骒舂┅换洞忾骒镝趔ㄉ排返船箝珙挡ǐ暴忾趔箝珙殒殂犷北忾趔屮痫铄铘ㄤ彐轭ㄩ铘唪镞骒镝舳轭舂ㄩ弪锟轭舂爱íㄩ弪锟ㄡ箬轭冻┅碑碑癌ㄥ痿ō祜玑钿ㄡ箬轭挡ｘ锋姗卑渤┅祜玳矧ｘ卑鞍鞍鞍鞍鞍鞍祜玑钿轭ｘ骀骀骀骀骀骀姗ㄥ痿挡┅┅ㄤ彐轭蝈徜怄祜狒洞ㄩ铘唪镞骒镝舳蝈徜忾铘洞┅ㄤ彐轭蝈徜戽祜狒洞ㄩ铘唪镞骒镝舳蝈徜扉铘洞┅ㄤ彐轭ㄦ祜狒洞唪镞轭舳骒舂戾è溽翎ㄩ铘彗弪溴泔溴骒镝骒舂┅戾è箝珙殒ㄣ狎溽翎┅ㄥ痫ㄣ徜溽翎┅箝珙ㄣ徜潋溽翎┅ㄩ屮痫箝珙殒癌祜玳矧ㄩ铄玑糸鲥箝珙ｘ赴鞍鞍鞍鞍鞍鞍鞍癌ㄡ箬ǐ屮痫卑返挡卑返ǐ挡卑渤祜玑钿箝珙殒ｘ骀骀骀骀骀骀姗┅┅ㄤ彐轭黩轸瀛怄祜狒洞骒舂黩轸瀛忾铘洞ㄦ祜狒洞唪镞轭舳骒舂┅ㄤ彐轭黩轸瀛戽祜狒洞骒舂黩轸瀛扉铘洞ㄦ祜狒洞唪镞轭舳骒舂┅换赴忾骒镝趔ㄉ排返船箝珙冻ǐ暴忾趔箝珙殒殂犷钡忾趔屮痫铄铘铄邃邃骘衢驺桢徜弪螬ㄤ彐轭蝈徜怄祜狒赴鹃铘戾è屮痫铄铘癌箝珙癌ㄢ蹑磲脲鲥泗矧卑┅ㄤèǐ暴┅è卑┅箦簟ㄢ蹑椹蝈徜怡翦┅箦簟屮痫铄铘祜玳矧ㄡ箬ㄢ蹑癌俯ㄢ蹑暴┅箦簟箝珙ㄩ铒祜玑钿屮痫铄铘ｘ赴鞍癌癌箦簟屮痫铄铘祜玑钿屮痫铄铘ｘ菲破┅戾è磲铘ǐㄡ箬ㄢ蹑博泊ㄡ箬ㄢ蹑畅倍ㄡ箬ㄢ蹑穿俯ㄢ蹑旦┅磲铘ǐㄡ箬ㄢ蹑订泊ㄡ箬ㄢ蹑珐倍ㄡ箬ㄢ蹑俯俯ㄢ蹑供┅ㄩ磲铘磲铘屮痫铄铘箝珙癌蝻躅íㄩ箝珙暴暴ㄥ痿伯ō屮痫铄铘倍掣钞癌ǐíㄥ痿伯潮癌磲铘暴íㄥ痿伯冻癌磲铘癌┅┅┅ㄤ彐轭黩轸瀛轭舡锯骒镝舾鲠飑戾è屮痫铄铘癌箝珙癌磲铘癌磲铘癌ㄩ铄玑糸鲥鲠飑ㄢ彗轭箦簟箝珙暴箦簟鲠ō鲠飑┅ㄩ铒弪锟鲠飑ㄢ彗轭箦簟屮痫铄铘蝻躅ǐ祜鲠伯癌倍掣钞癌┅箦簟鲠í鲠ㄥ痿ō倍幢屮痫铄铘┅┅倍幢ǐ倍掣潮箦簟磲铘ㄦ祜矧鲠飑箦簟鲠ō鲠磲铘暴箦簟磲铘ㄦ祜矧í鲠ㄥ痿巢┅┅┅黩轸瀛怡翦祜玳矧ㄡ箬箝珙珐ㄡ箬屮痫铄铘俯┅黩轸瀛怡翦祜玑钿屮痫铄铘ｘ破┅ㄤèǐ暴泊ō俯┅è订黩轸瀛怡翦祜玑钿ㄡ箬磲铘ō戛ｘ破┅ㄤèǐ暴泊ō俯┅è卑┅黩轸瀛怡翦祜玑钿ㄡ箬磲铘ō戛ｘ破┅┅换⑨酡ㄎ遑辕吁瞟桢徜弪ㄤ彐轭蝈徜狨桢徜弪骈戾鏖翳轭瘐舡骝镯骈戾骈戾灬礅溽ī戾è磲玳蝈徜汨狎螬┅ㄩ铒篝蜷铉娇磲玳箢洧┅ㄥ蝌矧р徜桢徜弪轶铒犷狨骈戾骈戾戾舄è溽翎祜汜糸镱蝈徜忾铘巢┅ㄤ狒岘箝蝈徜忾铘巢┅筢眇戾豉疱蝈徜忾铘巢┅篁狒蝈徜忾铘巢┅ㄣ桀蝈徜忾铘巢┅扉篝磲玳溽翎祜汜糸镱溽翎箝筢眇戾豉疱篁狒汨铙ㄩ锃蝈徜篝蜷铉┅┅┅┅轱蝈徜篝蜷铉泔眄孱ㄤ彐轭黩轸瀛狨桢徜弪骈戾汨铙篁狒溽翎箝筢眇戾豉疱泔眄孱舂溽翎箝轭怡翦换泔眄镱筢眇戾豉疱蠛眭灬鳜扉铄狎吒扉铄狎弑冬扉铄狎卟船扉铄狎叱铂骒镝衄滹踱戾卜犰狩鏖翳秕麴豸麸骈戾骈戾灬礅溽ī戾舄è泔盱孱戾铉翳泔眄孱舂ㄤ狒岘祜汜糸镱ǐ泊íㄦ祜矧ǐǒ泔盱孱穿┅┅┅黩轸瀛汨狎箢洧ㄦ矧遽汨黩轸瀛忾铘巢鲥泗矧溽翎祜汜糸镱溽翎箝筢眇戾豉疱篁狒汨铙┅戾è沲蜢镢泊┅ㄩ泔盱孱癌ㄢ彗轭ㄩ锃黩轸瀛篝蜷铉泔眄孱舂箦簟沲蜢镢ǐ沲蜢镢泔盱孱暴┅轱黩轸瀛篝蜷铉徜潴趄衢扉铉ㄤè沲蜢镢ǐ暴┅è窘溽翎祜汜糸镱┅黩轸瀛怡翦癌┅┅┅ㄤ彐轭蝈徜衢姝桢徜弪骈戾戾è溽翎祜汜糸镱癌ㄤ狒岘箝癌筢眇戾豉疱癌篁狒癌ㄣ桀癌ㄣ躜蝈铘祜汜糸镱癌鏖翳轭瘐舡骝镯骈戾骈戾灬礅溽ī戾è磲玳蝈徜汨狎螬┅ㄩ铒篝蜷铉娇磲玳⑵弦廷┅ㄥ蝌矧р徜桢徜弪轶铒犷衢骈戾英骈戾磲玳悌戾è箝蝈徜忾铘巢┅麒麽翳轶泔眄孱翦秕艨翳箝轶翳怡翦徭翦⑵弦廷磲玳蝈徜汨狎螬┅箦簟沲蝌孱舡祜汜糸镱辈ㄩ铒礤礅弪磲玳Ж⒘善脾⒘善芒篝蜷铉娇┅ㄥ蝌矧р徜桢徜弪轶铒犷衢骈戾英骈戾磲玳悌换铒祜镫骘翳⒂游蘑犷⒚贤廷汨躅塍ㄣ犰飙鏖翳屮轸灬礅溽蝈趱蝾戾祜镳ī戾è汨躅蝈徜汨狎螬ㄣ桴铍箝蝈徜忾铘巢┅ㄩ镤淇汨躅氕箝濠箦簟汨躅氕箝ǐ汨躅氕箝暴┅ㄩ篝蜷铉娇汨躅⒂游蘑ㄢ彗轭箦簟溽翎祜汜糸镱ǐ倍沲蝌孱舡祜汜糸镱蝈徜忾铘巢┅ㄩ篁狒癌蝈趱蝾扉篝磲玳溽翎祜汜糸镱溽翎箝筢眇戾豉疱篁狒汨铙┅┅ㄩ篝蜷铉娇汨躅⒚贤廷戾è戾癌箦簟汨铙蝈徜忾铘倍┅箦簟戾蝈徜忾铘巢┅箦簟筢眇戾豉疱蝈徜忾铘倍┅箦簟篁狒蝈徜怄祜狒赴鹃铘┅箦簟溽翎箝í戾汨铙筢眇戾豉疱悲俯ㄩ溽翎祜汜糸镱癌蝈趱蝾扉篝磲玳溽翎祜汜糸镱溽翎箝筢眇戾豉疱篁狒汨铙┅┅ㄤèǐ暴┅桢蝈麇蝈犰禊铄邃怩殪舡轭骈戾上篝蹑妗è汨躅氕箝濠ㄩㄥ镦镡赍泗蝈徜怡翦┅蝈趱蝾р徜桢徜弪┅┅箦簟沲蝌孱舡祜汜糸镱ǐ汨躅氕箝濠祜镳┅┅┅┅┅┅